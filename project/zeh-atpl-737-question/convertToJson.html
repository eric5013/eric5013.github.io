<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    
    <input type="file" name="files" id="fileConvert">
    <script>
        // AnsDict
        var ansDict = ["A", "A", "A", "B", "A", "A", "A", "B", "A", "A", "B", "A", "B", "B", "D", "D", "A", "A", "A", "D", "B", "C", "A", "B", "A", "A", "B", "B", "B", "B", "A", "B", "B", "A", "B", "A", "D", "D", "A", "C", "A", "B", "A", "A", "B", "B", "C", "A", "A", "B", "B", "B", "A", "A", "A", "A", "B", "C", "A", "A", "B", "D", "A", "D", "B", "B", "A", "D", "A", "C", "A", "A", "C", "A", "B", "A", "D", "B", "D", "B", "D", "A", "D", "B", "C", "A", "D", "A", "C", "A", "B", "D", "D", "D", "A", "B", "B", "A", "B", "B", "C", "C", "B", "D", "C", "C", "C", "D", "C", "D", "A", "B", "C", "B", "C", "D", "A", "A", "B", "B", "C", "D", "C", "C", "D", "A", "A", "B", "C", "D", "B", "C", "D", "B", "B", "C", "C", "B", "C", "D", "A", "D", "C", "B", "B", "C", "C", "A", "A", "C", "A", "A", "A", "A", "A", "D", "C", "B", "D", "A", "B", "A", "A", "D", "C", "A", "B", "A", "C", "B", "D", "A", "B", "A", "A", "B", "D", "B", "C", "D", "D", "A", "B", "B", "A", "D", "A", "D", "B", "C", "D", "B", "D", "D", "D", "C", "B", "B", "A", "B", "B", "A", "B", "A", "A", "B", "D", "A", "D", "C", "A", "B", "D", "D", "A", "D", "B", "B", "A", "A", "C", "B", "B", "D", "B", "D", "A", "B", "B", "A", "B", "A", "C", "A", "D", "B", "A", "B", "B", "A", "A", "D", "A", "B", "B", "B", "C", "A", "B", "B", "A", "C", "D", "C", "C", "C", "D", "D", "D", "B", "C", "B", "A", "D", "B", "D", "D", "C", "C", "B", "B", "A", "C", "B", "A", "D", "A", "B", "B", "A", "B", "A", "C", "D", "A", "C", "B", "B", "A", "D", "A", "B", "D", "A", "B", "D", "A", "D", "C", "A", "D", "A", "C", "A", "A", "B", "D", "D", "B", "C", "B", "B", "D", "B", "C", "D", "D", "A", "D", "C", "A", "A", "C", "C", "A", "B", "A", "C", "D", "C", "B", "D", "D", "B", "D", "B", "D", "A", "D", "C", "B", "A", "D", "D", "A", "C", "D", "D", "A", "A", "D", "D", "A", "D", "D", "D", "D", "B", "C", "B", "B", "C", "A", "D", "A", "A", "B", "B", "A", "A", "A", "A", "B", "B", "A", "A", "B", "B", "C", "B", "D", "A", "B", "C", "B", "B", "A", "B", "B", "C", "A", "B", "D", "A", "C", "D", "B", "C", "B", "A", "D", "C", "B", "C", "A", "B", "C", "B", "B", "A", "C", "B", "C", "B", "D", "C", "D", "B", "B", "C", "B", "D", "C", "D", "B", "C", "D", "A", "C", "B", "C", "D", "B", "C", "D", "D", "C", "B", "D", "A", "D", "B", "B", "B", "D", "A", "A", "A", "C", "A", "A", "A", "D", "B", "B", "B", "D", "A", "A", "A", "B", "A", "D", "B", "A", "A", "B", "B", "D", "D", "A", "B", "A", "A", "B", "B", "B", "A", "B", "D", "A", "A", "A", "A", "C", "A", "A", "A", "D", "B", "A", "C", "B", "C", "B", "C", "D", "D", "B", "A", "C", "D", "A", "B", "C", "D", "B", "C", "A", "B", "C", "C", "B", "B", "A", "B", "B", "A", "C", "D", "B", "C", "A", "A", "B", "D", "B", "B", "A", "C", "D", "A", "A", "A", "D", "B", "B", "B", "C", "C", "A", "C", "C", "C", "C", "D", "A", "B", "B", "C", "C", "C", "D", "A", "B", "B", "B", "C", "B", "A", "C", "A", "B", "C", "C", "A", "B", "B", "B", "D", "C", "D", "C", "B", "D", "A", "B", "B", "C", "C", "B", "B", "D", "D", "C", "B", "B", "A", "D", "D", "A", "C", "A", "A", "B", "B", "B", "A", "C", "A", "C", "A", "C", "B", "B", "B", "C", "A", "D", "C", "B", "B", "A", "B", "B", "B", "A", "A", "A", "C", "D", "A", "B", "D", "D", "A", "B", "A", "C", "D", "B", "C", "C", "A", "A", "D", "B", "A", "A", "A", "A", "D", "B", "C", "D", "C", "A", "A", "C", "B", "A", "D", "C", "C", "A", "C", "D", "A", "C", "C", "D", "D", "A", "B", "C", "C", "B", "C", "C", "A", "C", "B", "C", "C", "A", "C", "A", "D", "A", "A", "C", "B", "A", "C", "A", "D", "A", "A", "C", "C", "A", "B", "B", "C", "A", "D", "D", "D", "B", "C", "B", "D", "C", "C", "B", "B", "A", "C", "A", "B", "D", "A", "A", "B", "D", "C", "C", "A", "D", "C", "B", "D", "D", "A", "C", "D", "B", "A", "A", "D", "D", "A", "B", "D", "B", "B", "D", "B", "C", "B", "B", "A", "A", "A", "D", "C", "B", "B", "D", "B", "B", "D", "C", "D", "B", "B", "D", "D", "D", "D", "D", "A", "B", "C", "C", "B", "D", "B", "C", "C", "A", "B", "C", "D", "B", "D", "C", "D", "C", "C", "C", "A", "D", "A", "C", "C", "C", "C", "B", "D", "D", "B", "A", "C", "B", "B", "D", "D", "D", "A", "C", "D", "A", "D", "D", "D", "B", "A", "A", "A", "A", "B", "A", "C", "C", "B", "B", "A", "A", "C", "C", "B", "D", "B", "D", "C", "A", "C", "A", "D", "B", "B", "C", "C", "B", "C", "D", "D", "B", "B", "B", "D", "A", "C", "B", "A", "C", "A", "D", "D", "D", "D", "A", "B", "B", "C", "A", "C", "A", "A", "B", "B", "D", "B", "B", "B", "B", "D", "B", "B", "C", "D", "A", "A", "B", "B", "C", "D", "C", "B", "D", "B", "B", "B", "C", "B", "A", "B", "A", "A", "B", "A", "B", "A", "C", "C", "D", "A", "A", "B", "A", "D", "B", "A", "B", "A", "B", "C", "A", "D", "A", "D", "A", "A", "B", "B", "A", "C", "B", "C", "A", "D", "A", "C", "A", "B", "A", "A", "C", "C", "A", "A", "B", "B", "A", "A", "A", "C", "B", "D", "C", "D", "B", "A", "D", "B", "A", "B", "A", "C", "D", "C", "C", "C", "B", "A", "C", "C", "C", "C", "A", "C", "D", "D", "B", "D", "D", "A", "D", "C", "C", "D", "B", "A", "C", "C", "B", "B", "C", "D", "A", "A", "A", "C", "A", "B", "C", "A", "A", "B", "D", "A", "C", "C", "B", "C", "A", "C", "C", "C", "C", "A", "D", "A", "D", "B", "A", "C", "D", "B", "A", "C", "D", "B", "B", "C", "D", "B", "D", "C", "A", "D", "B", "A", "C", "D", "A", "B", "D", "B", "D", "C", "A", "A", "D", "B", "B", "C", "B", "A", "D", "B", "B", "C", "D", "A", "A", "C", "C", "B", "B", "C", "C", "B", "D", "B", "D", "A", "C", "D", "B", "D", "C", "D", "A", "C", "D", "B", "A", "C", "A", "B", "A", "A", "A", "C", "D", "C", "A", "D", "D", "B", "D", "D", "B", "D", "A", "A", "A", "C", "B", "B", "B", "C", "D", "B", "B", "C", "A", "B", "C", "B", "C", "B", "C", "C", "A", "A", "D", "D", "A", "A", "D", "B", "B", "B", "A", "B", "B", "B", "D", "B", "C", "C", "A", "C", "B", "A", "A", "A", "A", "C", "D", "A", "B", "A", "D", "B", "A", "D", "B", "C", "A", "C", "B", "A", "D", "C", "B", "B", "A", "A", "A", "A", "C", "A", "A", "A", "A", "B", "B", "A", "A", "A", "B", "D", "C", "A", "A", "A", "B", "B", "A", "B", "B", "D", "B", "D", "B", "D", "C", "A", "A", "A", "A", "A", "B", "B", "A", "A", "B", "B", "D", "A", "B", "B", "B", "B", "D", "B", "B", "B", "C", "C", "A", "A", "A", "B", "C", "A", "B", "D", "A", "A", "B", "B", "A", "B", "B", "B", "B", "C", "B", "A", "B", "B", "C", "C", "B", "B", "B", "A", "A", "A", "B", "C", "B", "C", "A", "B", "A", "D", "B", "A", "C", "A", "A", "D", "A", "A", "C", "C", "C", "B", "B", "B", "A", "C", "B", "A", "A", "C", "B", "C", "A", "B", "A", "B", "A", "A", "B", "B", "A", "A"] 
        
        var inputObj = document.getElementById("fileConvert")
        var readerResult = ""
        var reader = new FileReader()

        var regExp1 = new RegExp("\n[A-D].","g")
        var c3 = []


        // 判断选项是否赋值
        function checkExist(obj){
            if(typeof(obj) == "undefined" || obj == false){
                return null
            }else{
                if(typeof(obj) == "object"){
                    return obj[0]
                }else{
                    // D选项字符串
                    if(typeof(obj) == "string"){
                        return obj
                    }
                }
            }
        }

        // 删除多余的换行符
        var regEnter = new RegExp("\n","g")
        function delEnter(str) {
            var result = str.replace(regEnter,"")
            return result
        }

        // downFile
        function downFile(content, filename) {
            // 创建隐藏的可下载链接
            var eleLink = document.createElement('a');
            eleLink.download = filename;
            eleLink.style.display = 'none';
            // 字符内容转变成blob地址
            var blob = new Blob([content]);
            eleLink.href = URL.createObjectURL(blob);
            // 触发点击
            document.body.appendChild(eleLink);
            eleLink.click();
            // 然后移除
            document.body.removeChild(eleLink);
        };

        
        inputObj.addEventListener("change",()=>{
            reader.readAsText(inputObj.files[0])

        })


        reader.onload = function(){
            // var c1 = reader.result
            var c2 = reader.result.split("---questionspilt---")


            for(var i = 0;i<c2.length;i++){
                var item = {}
                var question = ""
                var optionA = ""
                var optionB = ""
                var optionC = ""
                var optionD = ""

                var num = c2[i].split("、")
                if(num.length === 2){
                    var questionAnsList = c2[i].split("、",2)[1].split(regExp1)
                    item.qId = parseInt(delEnter(num[0]))
                }else{
                    item.qId = parseInt(delEnter(num[0]))
                    var questionAnsList = num
                    questionAnsList.shift()
                    questionAnsList = questionAnsList.join("、")
                    questionAnsList = questionAnsList.split(regExp1)
                }
                
                // console.log(questionAnsList)

                switch (questionAnsList.length) {
                    case 0:
                        alert("ERROR: No Question and Ans Detected")
                        break;
                    case 1:
                        console.warn("Question " + i + ":only Question");
                        break;
                    case 2:
                        console.warn("Question " + i + ":only one Ans")
                        question = questionAnsList[0]
                        optionA = questionAnsList[1]
                        break;
                    case 3:
                        console.info("2 Ans")
                        question = questionAnsList[0]
                        optionA = questionAnsList[1]
                        optionB = questionAnsList[2]
                        break;
                    case 4:
                        console.info("3 Ans")
                        question = questionAnsList[0]
                        optionA = questionAnsList[1]
                        optionB = questionAnsList[2]
                        optionC = questionAnsList[3]
                        break;
                    case 5:
                        console.info("4 Ans")
                        question = questionAnsList[0]
                        optionA = questionAnsList[1]
                        optionB = questionAnsList[2]
                        optionC = questionAnsList[3]
                        optionD = questionAnsList[4]
                        break;

                }

                // 判断B选项后是否有其他选项
                // if(optionA[1].split(regExp3,2).length === 1){
                //     optionB = optionA[1].split(regExp3,2)
                // }else{
                //     optionB = optionA[1]
                // }
                // if(typeof(optionB) !== string){
                //     optionC = optionA[1].split(regExp3,2)[1].split(regExp4,2)
                // }
                // // 如果C存在
                // if(typeof(optionC) !== "undefined"){
                //     if(typeof(optionC) === "object"){
                //         // 判断数组C长度
                //         if(optionC.length === 1){
                //             // D不存在
                //             optionC = optionB.split(regExp4,2)[0]
                //         }else{
                //             // D存在
                //             optionC = optionB.split(regExp4,2)[0]
                //             optionD = optionB.split(regExp4,2)[1]
                //         }
                //     }
                // }




                
                // item.qId = parseInt(delEnter(num[0]))
                item.question = delEnter(questionAnsList[0])
                item.option = {}
                item.option.optionA = checkExist(optionA)
                item.option.optionB = checkExist(optionB)
                item.option.optionC = checkExist(optionC)
                item.option.optionD = checkExist(optionD)
                item.answer = ansDict[i]
                c3.push(item)
                console.log(i)
            }
        }
        
    </script>
</body>
</html>